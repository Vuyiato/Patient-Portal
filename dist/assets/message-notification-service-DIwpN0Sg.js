import{g as c,d as a,a as s,s as l,b as p,c as g}from"./index-D2oLNqmZ.js";const d=async e=>{try{console.log("üí¨ Preparing message notification:",{from:e.senderName,to:e.recipientId,role:e.recipientRole});const t={userId:e.recipientId,type:"new_message",title:`New message from ${e.senderName}`,message:e.messageText.length>100?e.messageText.substring(0,100)+"...":e.messageText,priority:"medium",read:!1,readAt:null,createdAt:l(),relatedTo:{chatId:e.chatId,senderId:e.senderId,senderRole:e.senderRole},actionUrl:(e.recipientRole==="patient","/chat")},i=await p(g(s,"notifications"),t);return console.log("‚úÖ Message notification sent successfully"),console.log("üéØ Notification ID:",i.id),console.log("üìç Firestore URL:",`https://console.firebase.google.com/project/dermaglareapp/firestore/data/notifications/${i.id}`),i.id}catch(t){throw console.error("‚ùå Error sending message notification:",t),t}},f=async(e,t)=>{try{console.log("üîç Getting recipient for chat:",{chatId:e,senderId:t});const i=await c(a(s,"chats",e));if(!i.exists())return console.error("‚ùå Chat document not found:",e),null;const o=i.data();if(console.log("üìã Chat data:",{patientId:o.patientId,userId:o.userId,senderId:t}),t===o.patientId||t===o.userId)return console.log("‚úÖ Sender is patient, recipient is admin"),{recipientId:"admin",recipientRole:"admin"};if(t==="admin"||t==="doctor"){const r=o.patientId||o.userId;return console.log("‚úÖ Sender is admin/doctor, recipient is patient:",r),{recipientId:r,recipientRole:"patient"}}return console.warn("‚ö†Ô∏è Could not determine recipient for chat:",e,"senderId:",t),null}catch(i){return console.error("‚ùå Error getting chat recipient:",i),null}},u=async(e,t,i,o,r)=>{try{const n=await f(e,t);if(!n){console.warn("‚ö†Ô∏è No recipient found, skipping notification");return}await d({chatId:e,senderId:t,senderName:i,senderRole:o,messageText:r,recipientId:n.recipientId,recipientRole:n.recipientRole})}catch(n){console.error("‚ùå Error notifying message recipient:",n)}};export{f as getChatRecipient,u as notifyMessageRecipient,d as sendMessageNotification};
