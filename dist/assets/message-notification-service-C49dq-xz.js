import{g as c,d as a,a as r,s as l,b as p,c as g}from"./index-CvwNvWRO.js";const f=async e=>{try{console.log("üí¨ Preparing message notification:",{from:e.senderName,to:e.recipientId,role:e.recipientRole});const t={userId:e.recipientId,type:"new_message",title:`New message from ${e.senderName}`,message:e.messageText.length>100?e.messageText.substring(0,100)+"...":e.messageText,priority:"medium",read:!1,readAt:null,createdAt:l(),relatedTo:{chatId:e.chatId,senderId:e.senderId,senderRole:e.senderRole},actionUrl:(e.recipientRole==="patient","/chat")},i=await p(g(r,"notifications"),t);return console.log("‚úÖ Message notification sent successfully"),console.log("üéØ Notification ID:",i.id),console.log("üìç Firestore URL:",`https://console.firebase.google.com/project/dermaglareapp/firestore/data/notifications/${i.id}`),i.id}catch(t){throw console.error("‚ùå Error sending message notification:",t),t}},d=async(e,t)=>{try{const i=await c(a(r,"chats",e));if(!i.exists())return console.error("‚ùå Chat document not found:",e),null;const o=i.data();return t===o.patientId||t===o.userId?{recipientId:"admin",recipientRole:"admin"}:t==="admin"||t==="doctor"?{recipientId:o.patientId||o.userId,recipientRole:"patient"}:(console.warn("‚ö†Ô∏è Could not determine recipient for chat:",e),null)}catch(i){return console.error("‚ùå Error getting chat recipient:",i),null}},u=async(e,t,i,o,s)=>{try{const n=await d(e,t);if(!n){console.warn("‚ö†Ô∏è No recipient found, skipping notification");return}await f({chatId:e,senderId:t,senderName:i,senderRole:o,messageText:s,recipientId:n.recipientId,recipientRole:n.recipientRole})}catch(n){console.error("‚ùå Error notifying message recipient:",n)}};export{d as getChatRecipient,u as notifyMessageRecipient,f as sendMessageNotification};
